CodeBehindForm
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
'---------------------------------------------------------------------------------------
'          __    _____   ______       ___       _____ ____    __
'         / /   /  _/ | / / __ \     |__ \     / ___// __ \  / /
'        / /    / //  |/ / / / /     __/ /     \__ \/ / / / / /
'       / /____/ // /|  / /_/ /     / __/     ___/ / /_/ / / /___
' _____/_____/___/_/ |_/\___\_\____/____/____/____/\___\_\/_____/
'/_____/                     /_____/   /_____/
'
' (c) Tim Getsch
' @author timgetsch@commitcs.com
' @license MIT (http://www.opensource.org/licenses/mit-license.php)
'---------------------------------------------------------------------------------------
Option Compare Database
Option Explicit

Private Sub cmdCreateLinkedTable_Click()
          Dim strTableName As String
10        On Error GoTo PROC_ERROR

20        strTableName = InputBox("Enter the source table name", "_LINQ Create Linked Table")
30        If strTableName <> "" Then
              Dim strNewTableName As String
40            strNewTableName = CreateLinkedTable(Me.ID, strTableName)
50            If strNewTableName <> "" Then
60                MsgBox "Created " & strNewTableName
70            Else
80                MsgBox "Failed to create linked table " & strTableName, vbExclamation
90            End If
100       End If

PROC_EXIT:
110       Exit Sub

PROC_ERROR:
120       LogError "Form__LinqRemoteConnections", "cmdCreateLinkedTable_Click", Erl, Err.Number, Err.Description
130       Resume PROC_EXIT
140       Resume
End Sub

Private Sub cmdGenerateCode_Click()
10        On Error GoTo PROC_ERROR
          
20        If IsNull(Me.ID) Then
30            MsgBox "An ID must be specified before using this command."
40            Me.ID.SetFocus
50            Exit Sub
60        End If
          
70        Me.Dirty = False

80        Init_NullableDataTypes
90        Init_BaseModules Me.CodeClassName
          
100       If AutoGenerateDatabaseClass(Me.ID) Then
110           AutoGenerateDBC
120           DoCmd.RunCommand acCmdVisualBasicEditor
130       End If

PROC_EXIT:
140       Exit Sub

PROC_ERROR:
150       LogError "Form__LinqRemoteConnections", "cmdGenerateCode_Click", Erl, Err.Number, Err.Description
160       Resume PROC_EXIT
170       Resume
End Sub

Private Sub cmdRelinkTable_Click()
          Dim strTableName As String
10        On Error GoTo PROC_ERROR

20        strTableName = InputBox("What table do you want to relink?", "_LINQ Relinked Table", Me.LinkedTablePrefix)
          
30        If strTableName <> "" Then
40            If Not IsObjectInCol(CurrentData.AllTables, strTableName) Then
50                MsgBox strTableName & " not found"
60            ElseIf RelinkTable(strTableName) Then
70                MsgBox "Relinked " & strTableName
80            Else
90                MsgBox "Failed to relink table " & strTableName, vbExclamation
100           End If
110       End If

PROC_EXIT:
120       Exit Sub

PROC_ERROR:
130       LogError "Form__LinqRemoteConnections", "cmdRelinkTable_Click", Erl, Err.Number, Err.Description
140       Resume PROC_EXIT
150       Resume
End Sub

Private Sub Form_Open(Cancel As Integer)
10        On Error GoTo PROC_ERROR

20        Me.Caption = "_LINQ_2_SQL Add-In v" & TOOL_VERSION
          
30        If Not IsObjectInCol(CurrentData.AllTables, LINQ_REMOTE_CONNECTIONS) Then
40            DoCmd.CopyObject CurrentDb.Name, LINQ_REMOTE_CONNECTIONS, acTable, LINQ_REMOTE_CONNECTIONS
50        End If
          
60        Set Me.Recordset = CurrentDb.OpenRecordset(LINQ_REMOTE_CONNECTIONS, dbOpenDynaset)

PROC_EXIT:
70        Exit Sub

PROC_ERROR:
80        LogError "Form__LinqRemoteConnections", "Form_Open", Erl, Err.Number, Err.Description
90        Resume PROC_EXIT
100       Resume
End Sub

Private Sub Password_BeforeUpdate(Cancel As Integer)
10        On Error GoTo PROC_ERROR

20        If Not IsNull(Password) Then
30            If vbYes <> MsgBox("This password will be stored in plain text in a hidden user system table.  It is recommended that you use Windows Authentication instead.  Do you want to save the password anyhow?", vbYesNo + vbDefaultButton2) Then
40                Cancel = True
50            End If
60        End If

PROC_EXIT:
70        Exit Sub

PROC_ERROR:
80        LogError "Form_USys_LinqRemoteConnections", "Password_BeforeUpdate", Erl, Err.Number, Err.Description
90        Resume PROC_EXIT
100       Resume
End Sub
